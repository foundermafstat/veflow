# Интеграция со смарт-контрактом VeFlowRegistry

## Обзор

Добавлена интеграция со смарт-контрактом VeFlowRegistry для отображения блупринтов из блокчейна VeChain в приложении VeFlow.

## Что было реализовано

### 1. Хуки для работы со смарт-контрактом

#### `useVeFlowContract`
- **Файл**: `client/src/hooks/use-veflow-contract.ts`
- **Функции**:
  - Загрузка всех блупринтов из контракта
  - Получение конкретного блупринта по ID
  - Получение блупринтов по автору
  - Получение общего количества блупринтов
  - Моковые данные для демонстрации

#### `useBlueprintMetadata`
- **Файл**: `client/src/hooks/use-blueprint-metadata.ts`
- **Функции**:
  - Загрузка метаданных из IPFS
  - Поддержка различных форматов URI (ipfs://, прямые хеши)
  - Моковые метаданные для демонстрации
  - Обработка ошибок и fallback данные

### 2. Обновленный хук `useBlueprints`

- **Файл**: `client/src/hooks/use-blueprints.ts`
- **Изменения**:
  - Интеграция с хуками смарт-контракта
  - Объединение блупринтов из API и смарт-контракта
  - Категория "smart-contract" для блупринтов из контракта

### 3. Компоненты

#### `SmartContractBlueprints`
- **Файл**: `client/src/components/flow/SmartContractBlueprints.tsx`
- **Функции**:
  - Отображение блупринтов из смарт-контракта
  - Красивые карточки с метаданными
  - Индикатор подключения к блокчейну
  - Демо режим с моковыми данными

#### Демонстрационная страница
- **Файл**: `client/src/app/smart-contract-blueprints/page.tsx`
- **Функции**:
  - Полная информация о контракте
  - Статистика блупринтов
  - Ссылки на block explorer
  - Навигация к Flow Builder

### 4. Обновления UI

#### `BlueprintPanel`
- **Файл**: `client/src/components/flow/BlueprintPanel.tsx`
- **Изменения**:
  - Добавлена иконка `Code` для категории "smart-contract"
  - Поддержка новых категорий блупринтов

#### Навигация
- **Файл**: `client/src/components/layout/main-navigation.tsx`
- **Изменения**:
  - Добавлен пункт "Smart Contracts" в главное меню
  - Иконка `Code` для нового раздела

### 5. Типы

#### `BlueprintMetadata`
- **Файл**: `client/src/types/blueprint.types.ts`
- **Изменения**:
  - Добавлены поля: `author`, `createdAt`, `updatedAt`, `active`
  - Сделаны опциональными: `inputs`, `outputs`

## Конфигурация контракта

### Адреса контрактов (VeChain Testnet)
```typescript
VeFlowRegistry: '0xc03db9560d8be616748b1b158d5fb99094e33f41'
```

### ABI
Используется ABI из `client/src/lib/contracts/abis.ts`:
- `VEFLOW_REGISTRY_ABI`

### Основные функции контракта
- `getBlueprint(uint256 blueprintId)` - Получение блупринта по ID
- `getBlueprintCount()` - Общее количество блупринтов
- `getBlueprintsByAuthor(address author)` - Блупринты автора
- `registerBlueprint(string metadataURI)` - Регистрация нового блупринта

## Моковые данные для демонстрации

### Блупринты из смарт-контракта:
1. **VeChain Token Transfer** (ID: 1)
   - Категория: smart-contract
   - Сложность: simple
   - Описание: Автоматический перевод VET токенов

2. **VeChain Energy Management** (ID: 2)
   - Категория: smart-contract
   - Сложность: medium
   - Описание: Мониторинг и управление VTHO энергией

3. **Smart Contract Event Monitor** (ID: 3)
   - Категория: smart-contract
   - Сложность: complex
   - Описание: Мониторинг событий смарт-контрактов

## Использование

### 1. Просмотр блупринтов из смарт-контракта
- Перейдите на страницу `/smart-contract-blueprints`
- Или используйте пункт "Smart Contracts" в главном меню

### 2. В Flow Builder
- Откройте `/flow/1`
- В боковой панели выберите "Blueprints"
- Блупринты из смарт-контракта будут отображаться в категории "smart-contract"

### 3. Подключение кошелька
- Для загрузки реальных данных подключите VeChain кошелек
- В демо режиме отображаются моковые данные

## Технические детали

### Интеграция с VeChain
- Используется `@vechain/dapp-kit-react` для подключения к кошельку
- Thor client для выполнения read-only операций
- Поддержка VeChain Testnet и Mainnet

### Обработка ошибок
- Graceful fallback на моковые данные
- Индикация статуса подключения
- Обработка ошибок загрузки метаданных

### Производительность
- Кэширование метаданных
- Параллельная загрузка блупринтов
- Ленивая загрузка метаданных

## Следующие шаги

1. **Реальная интеграция**: Подключение к реальному контракту на VeChain Testnet
2. **Регистрация блупринтов**: Добавление возможности регистрации новых блупринтов
3. **IPFS интеграция**: Загрузка реальных метаданных из IPFS
4. **Уведомления**: Уведомления о новых блупринтах в контракте
5. **Фильтрация**: Расширенные фильтры по авторам, датам, сложности

